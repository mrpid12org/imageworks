[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "imageworks"
version = "0.1.0"
dependencies = [
  "typer",
  "numpy",
  "opencv-python-headless",
  "Pillow",
  "scikit-image",
  "scipy",
  "tomli; python_version < '3.11'",
]
requires-python = ">=3.9"

[project.scripts]
imageworks-mono = "imageworks.apps.mono_checker.cli.mono:app"
imageworks-api = "imageworks.apps.mono_checker.api.main:start"
imageworks-zip = "imageworks.tools.zip_extract:app"


[tool.rye]
managed = true
dev-dependencies = [
    "ruff>=0.5.4",
    "pytest>=8.2.2",
    "black>=24.4.2",
    "mypy>=1.10.1",
    "pre-commit>=3.7.1",
]

[tool.hatch.metadata]
allow-direct-references = true

[tool.ruff]
line-length = 88
indent-width = 4

[tool.ruff.lint]
select = ["E4", "E7", "E9", "F"]

[tool.imageworks.mono]
# Default folder to scan when none is provided on the command line.
# Can be an absolute path or relative to the project root.
default_folder = "/mnt/d/Proper Photos/photos/ccc competition images"

# Default file extensions to look for.
default_exts = "jpg,jpeg,png,tif,tiff"

# Default path for the JSONL output file.
default_jsonl = "outputs/results/mono_results.jsonl"

# Default path for the human-readable summary file.
default_summary = "outputs/summaries/mono_summary.md"

# --- CORE THRESHOLDS ---
# Max channel diff (0-255) for a pixel to be considered neutral.
neutral_tol = 2
# Max chroma (C*) for an image to pass as neutral.
lab_neutral_chroma = 2.0
# Chroma (C*) threshold above which pixels are considered "colored" for hue stats.
lab_chroma_mask = 2.0
# Max hue standard deviation (degrees) for a clear PASS as toned.
lab_toned_pass_deg = 10.0
# Max hue standard deviation (degrees) for a PASS WITH QUERY.
lab_toned_query_deg = 14.0

# --- HARD FAIL THRESHOLDS ---
# Force a FAIL if the percentage of pixels with chroma > 4 exceeds this.
lab_fail_c4_ratio = 0.10
# Force a FAIL if the largest single cluster of pixels with chroma > 4 exceeds this.
lab_fail_c4_cluster = 0.08


# --- HEATMAP VISUALIZATION DEFAULTS ---
# Default suffix for generated heatmap images.
default_visualize_suffix = "_mono_vis"
# Overlay opacity for heatmaps.
auto_heatmap_alpha = 0.6
# JPEG quality for heatmaps.
auto_heatmap_quality = 92
# Saturation threshold for saturation/hue heatmaps.
auto_heatmap_sat_threshold = 0.06
# Chroma (C*) value that maps to maximum intensity in LAB heatmaps.
lab_chroma_clip = 8.0

# --- XMP WRITING DEFAULTS ---
# Default name for the generated ExifTool script.
default_xmp_script = "write_xmp.sh"
